% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Plug and play link estimation},
  pdfauthor={Tad Dallas},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{Plug and play link estimation}
\author{Tad Dallas}
\date{}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\hypertarget{load-packages}{%
\section{Load packages}\label{load-packages}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(Amelia)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Rcpp
\end{verbatim}

\begin{verbatim}
## ## 
## ## Amelia II: Multiple Imputation
## ## (Version 1.7.6, built: 2019-11-24)
## ## Copyright (C) 2005-2020 James Honaker, Gary King and Matthew Blackwell
## ## Refer to http://gking.harvard.edu/amelia/ for more information
## ##
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fields)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: spam
\end{verbatim}

\begin{verbatim}
## Loading required package: dotCall64
\end{verbatim}

\begin{verbatim}
## Loading required package: grid
\end{verbatim}

\begin{verbatim}
## Spam version 2.5-1 (2019-12-12) is loaded.
## Type 'help( Spam)' or 'demo( spam)' for a short introduction 
## and overview of this package.
## Help for individual functions is also obtained by adding the
## suffix '.spam' to the function name, e.g. 'help( chol.spam)'.
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'spam'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     backsolve, forwardsolve
\end{verbatim}

\begin{verbatim}
## Loading required package: maps
\end{verbatim}

\begin{verbatim}
## See https://github.com/NCAR/Fields for
##  an extensive vignette, other supplements and source code
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ROCR)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: gplots
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'gplots'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:stats':
## 
##     lowess
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(corpcor)}
\KeywordTok{library}\NormalTok{(np)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonparametric Kernel Methods for Mixed Datatypes (version 0.60-10)
## [vignette("np_faq",package="np") provides answers to frequently asked questions]
## [vignette("np",package="np") an overview]
## [vignette("entropy_np",package="np") an overview of entropy-based methods]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(plyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'plyr'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:maps':
## 
##     ozone
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:plyr':
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\hypertarget{make-some-colors}{%
\section{Make some colors}\label{make-some-colors}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ose1 <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{85}\NormalTok{,}\DecValTok{108}\NormalTok{,}\DecValTok{17}\NormalTok{, }\DataTypeTok{m=}\DecValTok{255}\NormalTok{)}
\NormalTok{ose2 <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{160}\NormalTok{,}\DecValTok{108}\NormalTok{,}\DecValTok{17}\NormalTok{, }\DataTypeTok{m=}\DecValTok{255}\NormalTok{)}
\NormalTok{ose3 <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{114}\NormalTok{,}\DecValTok{132}\NormalTok{,}\DecValTok{56}\NormalTok{, }\DataTypeTok{m=}\DecValTok{255}\NormalTok{)}
\NormalTok{ose4 <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{137}\NormalTok{,}\DecValTok{152}\NormalTok{,}\DecValTok{87}\NormalTok{, }\DataTypeTok{m=}\DecValTok{255}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-code-below-is-used-to-calculate-the-number-of-estimated-missing-links-from-host-parasite-networks}{%
\section{The code below is used to calculate the number of estimated
missing links from host-parasite
networks}\label{the-code-below-is-used-to-calculate-the-number-of-estimated-missing-links-from-host-parasite-networks}}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{host-virus-associations}{%
\section{Host-virus associations}\label{host-virus-associations}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' imputes missing data.}
\CommentTok{#'}
\CommentTok{#' @param listobject contains interaction matrix (intMat), host traits, parasite traits, and a points object that gets handed to pp.gauss}
\CommentTok{#' }
\CommentTok{#' @returns the same listobject, now with missing host and parasite trait data imputed and pointsobject updated.}

\NormalTok{getImpute <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(listobject, }\DataTypeTok{m=}\DecValTok{10}\NormalTok{, }\DataTypeTok{rem=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{useMeans=}\OtherTok{TRUE}\NormalTok{)\{}
    \KeywordTok{require}\NormalTok{(Amelia)}
    \KeywordTok{require}\NormalTok{(vegan)}

\NormalTok{  htriz <-}\StringTok{ }\NormalTok{listobject}\OperatorTok{$}\NormalTok{Hosts}
\NormalTok{    ptriz <-}\StringTok{ }\NormalTok{listobject}\OperatorTok{$}\NormalTok{Parasites}

  \CommentTok{#remove columns with less than 75% data coverage}
\NormalTok{  no  <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(htriz))}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(htriz) }\OperatorTok{>}\StringTok{ }\FloatTok{0.75}\NormalTok{)}
\NormalTok{    nop <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(ptriz))}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(ptriz) }\OperatorTok{>}\StringTok{ }\FloatTok{0.75}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(no) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{}
\NormalTok{    htriz <-}\StringTok{ }\NormalTok{htriz[,}\OperatorTok{-}\NormalTok{no]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(nop) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{}
\NormalTok{    ptriz <-}\StringTok{ }\NormalTok{ptriz[,}\OperatorTok{-}\NormalTok{nop]}
\NormalTok{  \}}

\CommentTok{# remove columns with correlation coeff}
\NormalTok{  no2 <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{cor}\NormalTok{(htriz, }\DataTypeTok{use=}\StringTok{'complete.obs'}\NormalTok{)[,}\DecValTok{1}\NormalTok{] }\OperatorTok{>}\StringTok{ }\FloatTok{0.6}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{length}\NormalTok{(no2) }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{)\{}
\NormalTok{    no2 <-}\StringTok{ }\NormalTok{no2[}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\NormalTok{        htriz =}\StringTok{ }\NormalTok{htriz[,}\OperatorTok{-}\NormalTok{no2]}
\NormalTok{  \}}

  \CommentTok{#remove rows without any data}
    \CommentTok{#hosts}
\NormalTok{  inds <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(htriz)))}
  \ControlFlowTok{if}\NormalTok{(rem}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
\NormalTok{    cut=}\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{nrow}\NormalTok{(htriz))}
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \KeywordTok{seq_len}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(htriz)))\{}
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{all}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(htriz[i,])))\{cut[i]=}\DecValTok{1}\NormalTok{\}}
\NormalTok{    \}}
\NormalTok{    htriz <-}\StringTok{ }\NormalTok{htriz[}\OperatorTok{-}\KeywordTok{which}\NormalTok{(cut}\OperatorTok{==}\DecValTok{1}\NormalTok{), ]}
\NormalTok{  \}}
    \CommentTok{#parasites}
\NormalTok{  indsP <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(ptriz)))}
  \ControlFlowTok{if}\NormalTok{(rem}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
\NormalTok{    cut=}\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{nrow}\NormalTok{(ptriz))}
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \KeywordTok{seq_len}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(ptriz)))\{}
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{all}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(ptriz[i,])))\{cut[i]=}\DecValTok{1}\NormalTok{\}}
\NormalTok{    \}}
\NormalTok{    ptriz <-}\StringTok{ }\NormalTok{ptriz[}\OperatorTok{-}\KeywordTok{which}\NormalTok{(cut}\OperatorTok{==}\DecValTok{1}\NormalTok{), ]}
\NormalTok{  \}}

 \CommentTok{#impute host traits}
 \ControlFlowTok{if}\NormalTok{(}\KeywordTok{any}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(htriz))))\{}
\NormalTok{    helper <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(htriz,}\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}\OperatorTok{>}\DecValTok{1}\NormalTok{)[}\DecValTok{1}\NormalTok{]}
\NormalTok{        tmp <-}\StringTok{ }\NormalTok{htriz[, }\KeywordTok{unique}\NormalTok{(}\KeywordTok{c}\NormalTok{(helper,inds))]}
        \ControlFlowTok{if}\NormalTok{(useMeans}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
\NormalTok{            means <-}\StringTok{ }\KeywordTok{which}\NormalTok{(}\KeywordTok{apply}\NormalTok{(tmp, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x)\{}\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(x))\})}\OperatorTok{/}\KeywordTok{ncol}\NormalTok{(tmp) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)}
\NormalTok{            tmp[means, ] <-}\StringTok{ }\KeywordTok{colMeans}\NormalTok{(tmp, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{            htriz2 <-}\StringTok{ }\NormalTok{tmp}
\NormalTok{        \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{        htriz2 <-}\StringTok{ }\KeywordTok{amelia}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ tmp, }\DataTypeTok{m=}\NormalTok{m, }\DataTypeTok{p2s=}\DecValTok{0}\NormalTok{)}\OperatorTok{$}\NormalTok{imputations[[m]]}
\NormalTok{        \}}
\NormalTok{      notInds <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{ncol}\NormalTok{(htriz),}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)[}\OperatorTok{-}\KeywordTok{c}\NormalTok{(helper,inds)]}
\NormalTok{      htriz3 <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(htriz2, htriz[,notInds])}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    htriz2 <-}\StringTok{ }\KeywordTok{amelia}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ htriz[, }\KeywordTok{c}\NormalTok{(inds)], }\DataTypeTok{m=}\NormalTok{m, }\DataTypeTok{p2s=}\DecValTok{0}\NormalTok{)}\OperatorTok{$}\NormalTok{imputations[[m]]}
\NormalTok{    notInds <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{ncol}\NormalTok{(htriz),}\DataTypeTok{by=}\DecValTok{1}\NormalTok{)[}\OperatorTok{-}\KeywordTok{c}\NormalTok{(inds)]}
\NormalTok{    htriz3 <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(htriz2, htriz[,notInds])}
\NormalTok{  \}}


  \CommentTok{#remake the points object}
\NormalTok{  intMat <-}\StringTok{ }\NormalTok{listobject}\OperatorTok{$}\NormalTok{intMat}
\NormalTok{  pos <-}\StringTok{ }\KeywordTok{which}\NormalTok{(intMat }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\DataTypeTok{arr.ind=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{  neg <-}\StringTok{ }\KeywordTok{which}\NormalTok{(intMat }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{, }\DataTypeTok{arr.ind=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{  ret <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(pos,neg) }
\NormalTok{  ret <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ret, }\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{nrow}\NormalTok{(pos)), }\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\KeywordTok{nrow}\NormalTok{(neg)))) }
  \KeywordTok{colnames}\NormalTok{(ret) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'parasite'}\NormalTok{, }\StringTok{'host'}\NormalTok{, }\StringTok{'presence'}\NormalTok{)}

\NormalTok{  pt <-}\StringTok{ }\NormalTok{ptriz[ret[,}\DecValTok{2}\NormalTok{],]}
\NormalTok{  ht <-}\StringTok{ }\NormalTok{htriz3[ret[,}\DecValTok{1}\NormalTok{],]}
\NormalTok{    ht <-}\StringTok{ }\NormalTok{ht[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\NormalTok{    ptobj <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(ret, ht, pt, }\DataTypeTok{stringsAsFactors=}\OtherTok{TRUE}\NormalTok{)}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{intMat=}\NormalTok{intMat, }\DataTypeTok{Hosts=}\NormalTok{htriz3, }
        \DataTypeTok{Parasites=}\NormalTok{ptriz, }\DataTypeTok{pointsObject=}\NormalTok{ptobj))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Train pp.gauss model on data}
\CommentTok{#'}
\CommentTok{#' @param pointsobject input to pp.gauss function}
\CommentTok{#' }
\CommentTok{#' @returns list object of host and parasite information, model predictions, and AUC value}

\NormalTok{getReal <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(pointsobject, }\DataTypeTok{cv=}\OtherTok{TRUE}\NormalTok{, }\DataTypeTok{folds=}\DecValTok{5}\NormalTok{)\{}
  \KeywordTok{require}\NormalTok{(ROCR)}
  \CommentTok{# all the data divided into presence (p) and background (bg)}
\NormalTok{  p <-}\StringTok{ }\NormalTok{pointsobject[(pointsobject[,}\StringTok{'presence'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
\NormalTok{  bg <-}\StringTok{ }\NormalTok{pointsobject[,}\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
  \ControlFlowTok{if}\NormalTok{(cv}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
        \CommentTok{# Take a random sample and exclude it}
\NormalTok{        ints <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(pointsobject), }\KeywordTok{nrow}\NormalTok{(pointsobject)}\OperatorTok{/}\NormalTok{folds)}
\NormalTok{        red <-}\StringTok{ }\NormalTok{pointsobject[}\OperatorTok{-}\NormalTok{ints,]}
\NormalTok{        p.red <-}\StringTok{ }\NormalTok{red[(red[,}\StringTok{'presence'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
\NormalTok{        bg.red <-}\StringTok{ }\NormalTok{red[, }\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
        \CommentTok{# Train the model on a portion of the data}
\NormalTok{        cvmodel <-}\StringTok{ }\KeywordTok{pp.gauss}\NormalTok{(}\DataTypeTok{p=}\NormalTok{p.red, }\DataTypeTok{bgrd=}\NormalTok{bg.red, }\DataTypeTok{vbose=}\OtherTok{FALSE}\NormalTok{)}
        \CommentTok{#... and predict on the holdout set}
\NormalTok{        red.preds <-}\StringTok{ }\KeywordTok{predict.pp.gauss}\NormalTok{(cvmodel, }\DataTypeTok{x=}\NormalTok{bg[ints,])}
\NormalTok{        ret <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{presence=}\NormalTok{pointsobject[ints,}\StringTok{'presence'}\NormalTok{], }\DataTypeTok{suitability=}\NormalTok{red.preds)}
\NormalTok{        hosts <-}\StringTok{ }\NormalTok{pointsobject[ints,}\StringTok{'parasite'}\NormalTok{]; parasites=pointsobject[ints,}\StringTok{'host'}\NormalTok{]}
\NormalTok{  \}}

  \ControlFlowTok{if}\NormalTok{(cv}\OperatorTok{==}\OtherTok{FALSE}\NormalTok{)\{}
\NormalTok{    fullmodel <-}\StringTok{ }\KeywordTok{pp.gauss}\NormalTok{(}\DataTypeTok{p=}\NormalTok{p, }\DataTypeTok{bgrd=}\NormalTok{bg, }\DataTypeTok{vbose=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    redpreds <-}\StringTok{ }\KeywordTok{predict.pp.gauss}\NormalTok{(fullmodel, }\DataTypeTok{x=}\NormalTok{bg)}
\NormalTok{    ret <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{presence=}\NormalTok{pointsobject[,}\StringTok{'presence'}\NormalTok{], }\DataTypeTok{suitability=}\NormalTok{redpreds)}
\NormalTok{    hosts <-}\StringTok{ }\NormalTok{pointsobject}\OperatorTok{$}\NormalTok{parasite; parasites=pointsobject}\OperatorTok{$}\NormalTok{host}
\NormalTok{  \}}
  \CommentTok{#auc calculation}
\NormalTok{  pred <-}\StringTok{ }\KeywordTok{prediction}\NormalTok{(}\DataTypeTok{predictions=}\NormalTok{ret[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{labels=}\NormalTok{ret[,}\DecValTok{1}\NormalTok{])}
\NormalTok{  acc <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{performance}\NormalTok{(pred, }\StringTok{'auc'}\NormalTok{)}\OperatorTok{@}\NormalTok{y.values)}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{hostInds=}\NormalTok{hosts, }\DataTypeTok{parasiteInds=}\NormalTok{parasites, }\DataTypeTok{predictions=}\NormalTok{ret, }\DataTypeTok{auc=}\NormalTok{acc))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{datBats <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(dat, host_order}\OperatorTok{==}\StringTok{'Chiroptera'}\NormalTok{)}

\CommentTok{## interaction matrix}
\NormalTok{intMatFull <-}\StringTok{ }\KeywordTok{as.data.frame.matrix}\NormalTok{(}\KeywordTok{table}\NormalTok{(datBats}\OperatorTok{$}\NormalTok{host_species, datBats}\OperatorTok{$}\NormalTok{virus_genus))}


\CommentTok{### created features}
\NormalTok{numParasites <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(intMatFull }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)}
\NormalTok{numHosts <-}\StringTok{ }\KeywordTok{colSums}\NormalTok{(intMatFull }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{h <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{host_species=}\KeywordTok{rownames}\NormalTok{(intMatFull))}
\NormalTok{host}\OperatorTok{$}\NormalTok{host_species <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(host}\OperatorTok{$}\NormalTok{MSW05_Genus, host}\OperatorTok{$}\NormalTok{MSW05_Species, }\DataTypeTok{sep=}\StringTok{' '}\NormalTok{)}
\NormalTok{h <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(h, host, }\DataTypeTok{by=}\StringTok{'host_species'}\NormalTok{)}
\NormalTok{h <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(h, cites, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{'host_species'}\NormalTok{=}\StringTok{'name'}\NormalTok{))}
\NormalTok{h}\OperatorTok{$}\NormalTok{X <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{h}\OperatorTok{$}\NormalTok{Pan <-}\StringTok{ }\OtherTok{NULL}






\CommentTok{### forming data.frame objects}
\NormalTok{host2 <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
    \KeywordTok{expandCol}\NormalTok{(h}\OperatorTok{$}\NormalTok{MSW05_Genus, }\StringTok{'hGenus'}\NormalTok{), }
    \KeywordTok{expandCol}\NormalTok{(h}\OperatorTok{$}\NormalTok{ForStrat.Value, }\StringTok{'hForStratValue'}\NormalTok{),}
    \KeywordTok{expandCol}\NormalTok{(h}\OperatorTok{$}\NormalTok{IUCN , }\StringTok{'hIUCN '}\NormalTok{),  }
\NormalTok{    h[,}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{60}\NormalTok{, }\DecValTok{62}\OperatorTok{:}\DecValTok{68}\NormalTok{)], }
\NormalTok{    numParasites}
\NormalTok{)}

\NormalTok{host2}\OperatorTok{$}\NormalTok{X12}\FloatTok{.2}\NormalTok{_Terrestriality <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.Vunk<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.Scav <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Activity.Nocturnal<-}\StringTok{ }\OtherTok{NULL} 
\NormalTok{host2}\OperatorTok{$}\NormalTok{X12}\FloatTok{.1}\NormalTok{_HabitatBreadth<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.Vfish<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.Nect <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.Seed<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{Diet.PlantO<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{urbc_1970AD<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{urbc_1980AD<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{urbc_1990AD<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{urbc_2000AD<-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{urbc_2005AD <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{hFamily.DELPHINIDAE <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{ForStrat.Value <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{IUCN <-}\StringTok{ }\OtherTok{NULL}


\CommentTok{# drop these too.}
\NormalTok{host2}\OperatorTok{$}\NormalTok{BodyMass.value <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{PET_mean_mm <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{HuPopDen_5p_n.km2 <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{host2}\OperatorTok{$}\NormalTok{HuPop_Den_min_n.km2 <-}\StringTok{ }\OtherTok{NULL}




\NormalTok{virus2 <-}\StringTok{ }\NormalTok{datBats }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(virus_genus) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{nHostSp=}\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(host_species)),}
        \DataTypeTok{nHostFam=}\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(host_family)),}
        \DataTypeTok{nHostOrder=}\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(host_order)))}

\NormalTok{virus2}\OperatorTok{$}\NormalTok{virus_genus <-}\StringTok{ }\OtherTok{NULL}

\CommentTok{## Points object}
\NormalTok{hvDat <-}\StringTok{ }\KeywordTok{makePoints}\NormalTok{(intMatFull, host2, virus2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{writeLinks <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(dat, model, }\DataTypeTok{fileName=}\StringTok{'DallasPredictions.csv'}\NormalTok{)\{}
\NormalTok{    linksDF <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{host=}\KeywordTok{rownames}\NormalTok{(dat[[}\DecValTok{1}\NormalTok{]])[model[[}\DecValTok{1}\NormalTok{]]],}
        \DataTypeTok{virus =} \KeywordTok{colnames}\NormalTok{(dat[[}\DecValTok{1}\NormalTok{]])[model[[}\DecValTok{2}\NormalTok{]]], }
        \DataTypeTok{presence =}\NormalTok{ model[[}\DecValTok{3}\NormalTok{]]}\OperatorTok{$}\NormalTok{presence,}
        \DataTypeTok{suitability =}\NormalTok{ model[[}\DecValTok{3}\NormalTok{]]}\OperatorTok{$}\NormalTok{suitability)}
\NormalTok{    linksDF <-}\StringTok{ }\NormalTok{linksDF[}\KeywordTok{order}\NormalTok{(linksDF}\OperatorTok{$}\NormalTok{suitability, }\DataTypeTok{decreasing=}\OtherTok{TRUE}\NormalTok{),]}
\NormalTok{    ret <-}\StringTok{ }\NormalTok{linksDF[}\KeywordTok{which}\NormalTok{(linksDF}\OperatorTok{$}\NormalTok{virus }\OperatorTok{==}\StringTok{ 'Betacoronavirus'}\NormalTok{), ]}
    \KeywordTok{write.csv}\NormalTok{(ret, }\DataTypeTok{file=}\NormalTok{fileName)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hvDati <-}\StringTok{ }\KeywordTok{getImpute}\NormalTok{(hvDat, }\DataTypeTok{m=}\DecValTok{5}\NormalTok{, }\DataTypeTok{useMeans=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\item
\begin{verbatim}
  Filter (host_order = CHIROPTERA) > PNP with trait approach (no latent) >  include citation counts > Return a csv of bat species and probability of interaction with virus_genus = ‘Betacoronavirus’ as outcome variable > DallasBatsCitations.csv
\end{verbatim}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hvOut1 <-}\StringTok{ }\KeywordTok{getReal}\NormalTok{(hvDati[[}\DecValTok{4}\NormalTok{]], }\DataTypeTok{cv=}\OtherTok{FALSE}\NormalTok{)}
\KeywordTok{writeLinks}\NormalTok{(}\DataTypeTok{dat=}\NormalTok{hvDati, }\DataTypeTok{model=}\NormalTok{hvOut1, }\DataTypeTok{fileName=}\StringTok{'DallasBatsCitations.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\item
\begin{verbatim}
  Filter (host_order = CHIROPTERA) > PNP with trait approach (no latent) >  don’t include citation counts > Return a csv of bat species and probability of interaction with virus_genus = ‘Betacoronavirus’ as outcome variable > DallasBatsUncorrected.csv
\end{verbatim}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hvDati[[}\DecValTok{2}\NormalTok{]]}\OperatorTok{$}\NormalTok{cites <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{hvDati[[}\DecValTok{4}\NormalTok{]]}\OperatorTok{$}\NormalTok{cites <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{hvOut2 <-}\StringTok{ }\KeywordTok{getReal}\NormalTok{(hvDati[[}\DecValTok{4}\NormalTok{]], }\DataTypeTok{cv=}\OtherTok{FALSE}\NormalTok{)}
\KeywordTok{writeLinks}\NormalTok{(}\DataTypeTok{dat=}\NormalTok{hvDati, }\DataTypeTok{model=}\NormalTok{hvOut2, }\DataTypeTok{fileName=}\StringTok{'DallasBatsUncorrected.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-approach-we-took-in-the-open-science-article-just-use-dissimilarity-values}{%
\subsubsection{The approach we took in the Open Science article (just
use dissimilarity
values)}\label{the-approach-we-took-in-the-open-science-article-just-use-dissimilarity-values}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Format the data from a list of interaction matrices to a data.frame }
\CommentTok{#' that can be input to the plug and play model.}
\CommentTok{#'}
\CommentTok{#'}
\CommentTok{#' @param intMatList list of interaction matrices}
\CommentTok{#' @param year year of prediction}
\CommentTok{#' @param lagYears number of years which to train the model on}
\CommentTok{#' @param distFun how to calculate dissimilarity values}

\NormalTok{formatPPobject <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(intMat,}
    \DataTypeTok{distFun=}\StringTok{'bray'}\NormalTok{, }\DataTypeTok{includeCitations=}\OtherTok{FALSE}\NormalTok{)\{}
    \KeywordTok{require}\NormalTok{(plyr)}
    \KeywordTok{require}\NormalTok{(dplyr)}
\NormalTok{    locSim <-}\StringTok{ }\KeywordTok{rowMeans}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(vegan}\OperatorTok{::}\KeywordTok{vegdist}\NormalTok{(intMat)))   }
\NormalTok{    pathSim <-}\StringTok{ }\KeywordTok{rowMeans}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(vegan}\OperatorTok{::}\KeywordTok{vegdist}\NormalTok{(}\KeywordTok{t}\NormalTok{(intMat))))}
\NormalTok{    simMat <-}\StringTok{ }\NormalTok{locSim }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(pathSim) }
\NormalTok{    locDF <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{host =} \KeywordTok{rownames}\NormalTok{(intMat), locSim)}

    \ControlFlowTok{if}\NormalTok{(includeCitations)\{}
\NormalTok{        locDF <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(locDF, cites,}\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{'host'}\NormalTok{=}\StringTok{'name'}\NormalTok{))}
\NormalTok{        locDF}\OperatorTok{$}\NormalTok{X <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{    \}}

\NormalTok{    pathDF <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{pathogen =} \KeywordTok{colnames}\NormalTok{(intMat), pathSim)}
\NormalTok{    df <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(intMat), }\KeywordTok{colnames}\NormalTok{(intMat))}
    \KeywordTok{colnames}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'host'}\NormalTok{, }\StringTok{'pathogen'}\NormalTok{)}
\NormalTok{    df}\OperatorTok{$}\NormalTok{presence <-}\StringTok{ }\KeywordTok{as.vector}\NormalTok{(intMat }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)}\OperatorTok{+}\DecValTok{0} 
\NormalTok{    df}\OperatorTok{$}\NormalTok{similarity <-}\StringTok{ }\KeywordTok{as.vector}\NormalTok{(simMat)}
\NormalTok{    df <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(df, pathDF, }\DataTypeTok{by=}\StringTok{'pathogen'}\NormalTok{)}
\NormalTok{    df <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(df, locDF, }\DataTypeTok{by=}\StringTok{'host'}\NormalTok{)}
    \KeywordTok{return}\NormalTok{(df)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Train pp.gauss model on data}
\CommentTok{#'}
\CommentTok{#' @param pointsobject input to pp.gauss function}
\CommentTok{#' @param cv (boolean) cross-validate the model?}
\CommentTok{#' @param folds number of cross-validation folds}
\CommentTok{#' @param newData data to predict on (default=NULL)}
\CommentTok{#' }
\CommentTok{#' @returns list object of host and parasite information, model predictions, and AUC value}
\NormalTok{getReal2 <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(pointsobject, }\DataTypeTok{cv=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{folds=}\DecValTok{5}\NormalTok{, }\DataTypeTok{newData=}\OtherTok{NULL}\NormalTok{)\{}
  \KeywordTok{require}\NormalTok{(ROCR)}
  \CommentTok{# all the data divided into presence (p) and background (bg)}
\NormalTok{  p <-}\StringTok{ }\NormalTok{pointsobject[(pointsobject[,}\StringTok{'presence'}\NormalTok{] }\OperatorTok{>=}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
\NormalTok{  bg <-}\StringTok{ }\NormalTok{pointsobject[,}\DecValTok{3}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
  \ControlFlowTok{if}\NormalTok{(cv}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
        \CommentTok{# Take a random sample and exclude it}
\NormalTok{        ints <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(pointsobject), }\KeywordTok{nrow}\NormalTok{(pointsobject)}\OperatorTok{/}\NormalTok{folds)}
\NormalTok{        red <-}\StringTok{ }\NormalTok{pointsobject[}\OperatorTok{-}\NormalTok{ints,]}
\NormalTok{        p.red <-}\StringTok{ }\NormalTok{red[(red[,}\StringTok{'presence'}\NormalTok{] }\OperatorTok{>=}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
\NormalTok{        bg.red <-}\StringTok{ }\NormalTok{red[, }\DecValTok{3}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(pointsobject)]}
        \CommentTok{# Train the model on a portion of the data}
\NormalTok{        cvmodel <-}\StringTok{ }\KeywordTok{pp.gauss}\NormalTok{(}\DataTypeTok{p=}\NormalTok{p.red, }\DataTypeTok{bgrd=}\NormalTok{bg.red, }\DataTypeTok{vbose=}\OtherTok{FALSE}\NormalTok{)}
        \CommentTok{#... and predict on the holdout set}
\NormalTok{        red.preds <-}\StringTok{ }\KeywordTok{predict.pp.gauss}\NormalTok{(cvmodel, }\DataTypeTok{x=}\NormalTok{bg[ints,])}
\NormalTok{        ret <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{presence=}\NormalTok{pointsobject[ints,}\StringTok{'presence'}\NormalTok{], }\DataTypeTok{suitability=}\NormalTok{red.preds)}
\NormalTok{        hosts <-}\StringTok{ }\NormalTok{pointsobject[ints,}\StringTok{'host'}\NormalTok{]}
\NormalTok{        parasites <-}\StringTok{ }\NormalTok{pointsobject[ints,}\StringTok{'pathogen'}\NormalTok{]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(cv}\OperatorTok{==}\OtherTok{FALSE}\NormalTok{)\{}
\NormalTok{    fullmodel <-}\StringTok{ }\KeywordTok{pp.gauss}\NormalTok{(}\DataTypeTok{p=}\NormalTok{p, }\DataTypeTok{bgrd=}\NormalTok{bg, }\DataTypeTok{vbose=}\OtherTok{FALSE}\NormalTok{)}
        \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.null}\NormalTok{(newData))\{}
\NormalTok{            redpreds <-}\StringTok{ }\KeywordTok{predict.pp.gauss}\NormalTok{(fullmodel, }\DataTypeTok{x=}\NormalTok{newData[,}\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(newData)])}
\NormalTok{          ret <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{presence=}\NormalTok{newData[,}\StringTok{'presence'}\NormalTok{], }\DataTypeTok{suitability=}\NormalTok{redpreds)}
\NormalTok{          hosts <-}\StringTok{ }\NormalTok{newData}\OperatorTok{$}\NormalTok{host}
\NormalTok{            parasites <-}\StringTok{ }\NormalTok{newData}\OperatorTok{$}\NormalTok{pathogen}
\NormalTok{        \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{            redpreds <-}\StringTok{ }\KeywordTok{predict.pp.gauss}\NormalTok{(fullmodel, }\DataTypeTok{x=}\NormalTok{bg)}
\NormalTok{          ret <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{presence=}\NormalTok{pointsobject[,}\StringTok{'presence'}\NormalTok{], }\DataTypeTok{suitability=}\NormalTok{redpreds)}
\NormalTok{          hosts <-}\StringTok{ }\NormalTok{pointsobject}\OperatorTok{$}\NormalTok{host}
\NormalTok{            parasites <-}\StringTok{ }\NormalTok{pointsobject}\OperatorTok{$}\NormalTok{pathogen}
\NormalTok{        \}}
\NormalTok{  \}}
\NormalTok{    tss <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}
        \KeywordTok{max}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{performance}\NormalTok{(x, }\StringTok{'sens'}\NormalTok{)}\OperatorTok{@}\NormalTok{y.values)}\OperatorTok{+}\StringTok{ }
\StringTok{            }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{performance}\NormalTok{(x, }\StringTok{'spec'}\NormalTok{)}\OperatorTok{@}\NormalTok{y.values) }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{    \}}
  \CommentTok{#auc calculation}
\NormalTok{  pred <-}\StringTok{ }\KeywordTok{prediction}\NormalTok{(}\DataTypeTok{predictions=}\NormalTok{ret[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{labels=}\NormalTok{ret[,}\DecValTok{1}\NormalTok{])}
\NormalTok{  acc <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{performance}\NormalTok{(pred, }\StringTok{'auc'}\NormalTok{)}\OperatorTok{@}\NormalTok{y.values)}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{hostInds=}\NormalTok{hosts, }\DataTypeTok{parasiteInds=}\NormalTok{parasites, }\DataTypeTok{predictions=}\NormalTok{ret, }
        \DataTypeTok{auc=}\NormalTok{acc))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
\begin{verbatim}
  Entire dataset > PNP with latent approach (no traits) > include citation counts > Return a csv of mammal species and probability of interaction with virus_genus = ‘Betacoronavirus’ as outcome variable > DallasMammalsCitations.csv
\end{verbatim}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{intMatFull <-}\StringTok{ }\KeywordTok{as.data.frame.matrix}\NormalTok{(}\KeywordTok{table}\NormalTok{(dat}\OperatorTok{$}\NormalTok{host_species, dat}\OperatorTok{$}\NormalTok{virus_genus))}
\NormalTok{test <-}\StringTok{ }\KeywordTok{formatPPobject}\NormalTok{(intMatFull, }\DataTypeTok{includeCitations=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Column `host`/`name` joining factor and character vector, coercing into
## character vector
\end{verbatim}

\begin{verbatim}
## Warning: Column `host` joining factor and character vector, coercing into
## character vector
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out <-}\StringTok{ }\KeywordTok{getReal}\NormalTok{(test, }\DataTypeTok{cv=}\OtherTok{FALSE}\NormalTok{)}

\NormalTok{mamLinks <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(test, }\DataTypeTok{suitability=}\NormalTok{out}\OperatorTok{$}\NormalTok{predictions[,}\StringTok{'suitability'}\NormalTok{])}
\NormalTok{mLinksCites <-}\StringTok{ }\NormalTok{mamLinks[}\KeywordTok{which}\NormalTok{(mamLinks}\OperatorTok{$}\NormalTok{pathogen }\OperatorTok{==}\StringTok{ 'Betacoronavirus'}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{'host'}\NormalTok{,}\StringTok{'pathogen'}\NormalTok{, }\StringTok{'presence'}\NormalTok{, }\StringTok{'suitability'}\NormalTok{)]}
\KeywordTok{colnames}\NormalTok{(mLinksCites)[}\DecValTok{2}\NormalTok{] <-}\StringTok{ 'virus'}
\KeywordTok{write.csv}\NormalTok{(mLinksCites, }\DataTypeTok{file=}\StringTok{'DallasMammalsCitations.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
\begin{verbatim}
  Entire dataset > PNP with latent approach (no traits) > don’t include citation counts > Return a csv of mammal species and probability of interaction with virus_genus = ‘Betacoronavirus’ as outcome variable > DallasMammalsUncorrected.csv
\end{verbatim}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test2 <-}\StringTok{ }\KeywordTok{formatPPobject}\NormalTok{(intMatFull, }\DataTypeTok{includeCitations=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{out2 <-}\StringTok{ }\KeywordTok{getReal}\NormalTok{(test2, }\DataTypeTok{cv=}\OtherTok{FALSE}\NormalTok{)}

\NormalTok{mamLinksNoCites <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(test, }\DataTypeTok{suitability=}\NormalTok{out2}\OperatorTok{$}\NormalTok{predictions[,}\StringTok{'suitability'}\NormalTok{])}
\NormalTok{mLinksNoCites <-}\StringTok{ }\NormalTok{mamLinksNoCites[}\KeywordTok{which}\NormalTok{(mamLinksNoCites}\OperatorTok{$}\NormalTok{pathogen }\OperatorTok{==}\StringTok{ 'Betacoronavirus'}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{'host'}\NormalTok{,}\StringTok{'pathogen'}\NormalTok{, }\StringTok{'presence'}\NormalTok{, }\StringTok{'suitability'}\NormalTok{)]}
\KeywordTok{colnames}\NormalTok{(mLinksNoCites)[}\DecValTok{2}\NormalTok{] <-}\StringTok{ 'virus'}
\KeywordTok{write.csv}\NormalTok{(mLinksNoCites, }\DataTypeTok{file=}\StringTok{'DallasMammalsUncorrected.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{document}
